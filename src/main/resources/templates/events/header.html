<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<body>
<div th:fragment="header">

    <link rel="stylesheet" th:href="@{/css/header.css}">

    <nav class="navbar">
        <!-- LOGO -->
        <div class="nav-left">
            <a th:href="@{/}">
                <img th:src="@{/images/bi_bk_header.png}" class="logo" alt="CARDGORILLA">
            </a>
        </div>

        <!-- CENTER MENU -->
        <ul class="nav-center">
            <li><a th:href="@{/events}">브랜드별 카드 찾기</a></li>
            <li><a th:href="@{/events/top}">인기 카드 TOP10</a></li>
            <li><a th:href="@{/events/benefits}">혜택별 카드 추천</a></li>

            <li class="nav-item dropdown">
                <button type="button" class="dropdown-toggle">이색카드 추천</button>

                <ul class="dropdown-menu">
                    <li><a th:href="@{/events/random}">🎲 지금의 행운 카드</a></li>
                    <li><a th:href="@{/events/mbti}">MBTI별 카드추천</a></li>
                </ul>
            </li>
            <li><a th:href="@{/event/eventlist}">이벤트 목록</a></li>
        </ul>

        <!-- ADMIN MENU -->
        <li sec:authorize="hasRole('ADMIN')">
            <a th:href="@{/admin}">관리자 페이지</a>
        </li>

        <!-- RIGHT MENU -->
        <div class="nav-right">

            <!-- 로그인 X -->
            <div class="login" sec:authorize="!isAuthenticated()">
                <a th:href="@{/member/login}">로그인</a>
                <a th:href="@{/member/signup}">회원가입</a>
            </div>

            <!-- 로그인 O -->
            <div class="login" sec:authorize="isAuthenticated()">
                <span th:text="${#authentication.principal.member.name + '님'}"></span>

                <a th:href="@{/member/mypage}">마이페이지</a>

                <form th:action="@{/member/logout}" method="post" class="logout-form">
                    <button type="submit" class="logout-link">로그아웃</button>
                </form>
            </div>

        </div>
    </nav>

    <!-- JS -->
    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", () => {
            const toggles = document.querySelectorAll(".dropdown-toggle");

            toggles.forEach(btn => {
                btn.addEventListener("click", e => {
                    e.stopPropagation();
                    const menu = btn.closest(".dropdown").querySelector(".dropdown-menu");

                    document.querySelectorAll(".dropdown-menu")
                        .forEach(m => { if (m !== menu) m.classList.remove("open"); });

                    menu.classList.toggle("open");
                });
            });

            document.addEventListener("click", () => {
                document.querySelectorAll(".dropdown-menu")
                    .forEach(m => m.classList.remove("open"));
            });
        });
    </script>

</div>
</body>
</html>
