<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ÌòúÌÉùÎ≥Ñ Ïπ¥Îìú Ï∂îÏ≤ú (AND Ï°∞Í±¥)</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f6f8;
            margin: 0;
            padding: 40px;
            opacity: 0;
            transition: opacity 0.6s ease-in-out;
        }
        body.loaded { opacity: 1; }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        form {
            text-align: center;
            margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 10px;
            width: 250px;
            border-radius: 20px;
            border: 1px solid #aaa;
        }

        button {
            padding: 10px 20px;
            border: none;
            background-color: #667eea;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        button:hover { background-color: #5a67d8; }

        /* ÌòúÌÉù Î≤ÑÌäº */
        .benefit-buttons {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 25px 0;
        }

        .benefit-buttons button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 3px 6px rgba(0,0,0,0.15);
        }

        .benefit-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.25);
        }

        .benefit-buttons button.active {
            background: #ff7f50;
        }

        /* Ïπ¥Îìú Î¶¨Ïä§Ìä∏ */
        .card-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 260px;
            padding: 15px;
            text-align: center;
            overflow: hidden;
            transition: all 0.3s ease-in-out;
        }

        .card img {
            width: 100%;
            height: 150px;
            object-fit: contain;
        }

        h3 { margin: 10px 0; color: #222; }
        p { margin: 4px 0; color: #555; font-size: 0.9em; }

        /* ÌòúÌÉù ÏÉÅÏÑ∏ */
        .bnfDetail {
            max-height: 50px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            font-size: 0.85em;
            color: #444;
            text-align: left;
            white-space: pre-line;
        }

        .bnfDetail.expanded { max-height: 500px; }

        .toggle-btn {
            cursor: pointer;
            color: #2575fc;
            font-weight: bold;
            font-size: 0.9em;
            margin-top: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
<h1>üéØ ÌòúÌÉùÎ≥Ñ Ïπ¥Îìú Ï∂îÏ≤ú (AND Ï°∞Í±¥)</h1>

<form action="/events/benefits" method="get">
    <input type="text" name="keyword" placeholder="Ïòà: Ïª§Ìîº, Ï£ºÏú†, ÍµêÌÜµ" th:value="${keyword}">
    <button type="submit">Í≤ÄÏÉâ</button>
</form>

<!-- ‚úÖ ÌòúÌÉù Î≤ÑÌäº Î™©Î°ù -->
<div class="benefit-buttons" id="benefitButtons"></div>

<!-- ‚úÖ Ïπ¥Îìú Î¶¨Ïä§Ìä∏ -->
<div class="card-list" id="cardList">
    <div class="card" th:each="ev : ${events}" th:data-bnf="${ev.benefit.bnfName}">
        <img th:src="${ev.card.cardImg != '' ? ev.card.cardImg : '/images/bono.png'}"
             onerror="this.onerror=null;this.src='/images/bono.png';"
             alt="card image">
        <h3 th:text="${ev.card.cardName}"></h3>
        <p th:text="'Î∏åÎûúÎìú: ' + ${ev.card.cardBrand}"></p>
        <p th:text="${ev.benefit.bnfContent}"></p>
        <p class="bnfDetail" th:text="${ev.benefit.bnfDetail}"></p>
        <span class="toggle-btn" onclick="toggleDetail(this)">ÎçîÎ≥¥Í∏∞</span>
    </div>
</div>

<script th:inline="javascript">
    window.addEventListener('load', () => {
        document.body.classList.add('loaded');

        const events = /*[[${events}]]*/ [];
        const container = document.getElementById('benefitButtons');

        // ‚úÖ Ï°∞Í±¥: 5Í∏ÄÏûê Ïù¥Ìïò & Ïà´Ïûê ÏóÜÏùå
        const bnfNames = [...new Set(events
            .map(ev => ev.benefit?.bnfName)
            .filter(name => name && name.length <= 5 && !/\d/.test(name))
        )].sort();

        // ‚úÖ ÌôúÏÑ±ÌôîÎêú ÌòúÌÉù Ï†ÄÏû•
        const activeBenefits = new Set();

        // ‚úÖ Î≤ÑÌäº ÏÉùÏÑ±
        bnfNames.forEach(name => {
            const btn = document.createElement('button');
            btn.textContent = name;
            btn.addEventListener('click', () => {
                // ÌÅ¥Î¶≠ ÌÜ†Í∏Ä (ON/OFF)
                if (activeBenefits.has(name)) {
                    activeBenefits.delete(name);
                    btn.classList.remove('active');
                } else {
                    activeBenefits.add(name);
                    btn.classList.add('active');
                }

                // Ïπ¥Îìú ÌïÑÌÑ∞ÎßÅ (AND Ï°∞Í±¥)
                const activeArray = [...activeBenefits];
                document.querySelectorAll('.card').forEach(card => {
                    const bnf = card.dataset.bnf || "";
                    if (activeArray.length === 0) {
                        // ÏïÑÎ¨¥ Í≤ÉÎèÑ ÏÑ†ÌÉù Ïïà ÎêòÏñ¥ ÏûàÏúºÎ©¥ Ï†ÑÏ≤¥ ÌëúÏãú
                        card.style.display = 'block';
                    } else {
                        // Î™®Îì† ÌòúÌÉùÏù¥ Ïπ¥Îìú ÌòúÌÉùÎ™ÖÏóê Ìè¨Ìï®ÎêòÏñ¥Ïïº ÌëúÏãú (AND Ï°∞Í±¥)
                        const matchAll = activeArray.every(keyword => bnf.includes(keyword));
                        card.style.display = matchAll ? 'block' : 'none';
                    }
                });
            });
            container.appendChild(btn);
        });
    });

    // ‚úÖ ÎçîÎ≥¥Í∏∞ / Ï†ëÍ∏∞ Í∏∞Îä•
    function toggleDetail(btn) {
        const detail = btn.previousElementSibling;
        if(detail.classList.contains('expanded')) {
            detail.classList.remove('expanded');
            btn.innerText = 'ÎçîÎ≥¥Í∏∞';
        } else {
            detail.classList.add('expanded');
            btn.innerText = 'Ï†ëÍ∏∞';
        }
    }
</script>
</body>
</html>

