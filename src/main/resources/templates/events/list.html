<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>카드 리스트</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
        }

        /* 검색창 */
        form {
            text-align: center;
            margin-bottom: 25px;
        }

        form input[type=text] {
            padding: 12px 18px;
            width: 300px;
            border-radius: 25px;
            border: 1.5px solid #d4d7e2;
            font-size: 15px;
        }

        form button {
            padding: 12px 20px;
            background: #6c5ce7;
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* 카드 리스트 */
        .card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
        }

        .card-item {
            background-color: white;
            border-radius: 12px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .card-item img {
            width: 100%;
            height: 160px;
            object-fit: contain;
            border-radius: 8px;
            margin-bottom: 12px;
            background-color: #e2e8f0;
        }

        h3 {
            margin: 8px 0;
            text-align: center;
            font-size: 1.15em;
        }

        /* 혜택 박스 */
        .benefit-block {
            width: 100%;
            background: #f8f9fa;
            padding: 10px 12px;
            border-radius: 10px;
            margin-top: 10px;
            max-height: 150px;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .benefit-block.expanded {
            max-height: 2000px;
        }

        .benefit-title {
            font-weight: bold;
            color: #2575fc;
            margin-bottom: 4px;
        }

        .toggle-btn {
            cursor: pointer;
            color: #2575fc;
            font-weight: bold;
            font-size: 0.9em;
            display: inline-block;
            margin-top: 8px;
        }

        /* 더보기 버튼 */
        #loadMoreBtn {
            display: none;
            margin: 30px auto;
            padding: 10px 25px;
            background-color: #444;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
        }
    </style>
</head>
<body>

<div th:replace="events/header :: header"></div>

<h1>카드 찾기</h1>

<!-- 검색창: 브랜드 버튼 제거 후 /events/list 로 정상 요청 -->
<form action="/events/list" method="get">
    <input type="text"
           name="keyword"
           placeholder="검색어 입력 (예: 신한, 국민)"
           th:value="${keyword}">
    <button type="submit">검색</button>
</form>

<!-- 카드 리스트 -->
<div class="card-list" id="cardList">

    <div class="card-item" th:each="ev : ${events}">
        <img th:src="${ev.card.cardImg != '' ? ev.card.cardImg : '/images/bono.png'}"
             onerror="this.src='/images/bono.png'">

        <h3 th:text="${ev.card.cardName}"></h3>
        <p>브랜드: <span th:text="${ev.card.cardBrand}"></span></p>

        <div class="benefit-block">
            <div th:each="b : ${ev.benefits}">
                <p class="benefit-title" th:text="${b.bnfName}"></p>
                <p th:text="${b.bnfContent}"></p>
                <p th:text="${b.bnfDetail}"></p>
                <br>
            </div>
        </div>

        <span class="toggle-btn" onclick="toggleBenefit(this)">더보기</span>
    </div>

</div>

<button id="loadMoreBtn">더보기</button>

<div th:replace="events/footer :: footer"></div>

<script>
    /* 혜택 토글 */
    function toggleBenefit(btn) {
        const block = btn.previousElementSibling;
        block.classList.toggle("expanded");
        btn.innerText = block.classList.contains("expanded") ? "접기" : "더보기";
    }

    /* 20개씩 로드 */
    window.addEventListener("DOMContentLoaded", applyLoadMore);

    function applyLoadMore() {
        const cards = [...document.querySelectorAll("#cardList .card-item")];
        const btn = document.getElementById("loadMoreBtn");
        const batch = 20;
        let count = 0;

        cards.forEach(c => c.style.display = "none");

        function load() {
            cards.slice(count, count + batch).forEach(c => c.style.display = "flex");
            count += batch;
            btn.style.display = count >= cards.length ? "none" : "block";
        }

        if (cards.length > 0) load();

        btn.onclick = load;
    }
</script>

</body>
</html>
