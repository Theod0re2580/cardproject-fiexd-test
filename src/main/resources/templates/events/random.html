<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ì˜¤ëŠ˜ì˜ ì¹´ë“œ ğŸ²</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <style>
        /* =============================
   GLOBAL
============================= */
        body {
            font-family: 'Pretendard Variable', 'Segoe UI', sans-serif;
            margin: 0;
            color: #141414;
            text-align: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        h1 {
            font-size: 2.4em;
            margin-bottom: 40px;
            color: #111;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* =============================
           ì¹´ë“œ ì»¨í…Œì´ë„ˆ
        ============================= */
        .cards-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 45px;
            padding: 20px;
        }

        /* =============================
           ì¹´ë“œ flip ìŠ¤íƒ€ì¼
        ============================= */
        .flip-card {
            width: 280px;
            height: 420px;
            perspective: 1100px;
            cursor: pointer;
            transition: transform .3s ease;
        }
        .flip-card:hover {
            transform: translateY(-8px);
        }

        .flip-card-inner {
            width: 100%;
            height: 100%;
            transition: transform 0.75s ease;
            transform-style: preserve-3d;
        }
        .flip-card.flipped .flip-card-inner {
            transform: rotateY(180deg);
        }

        /* =============================
           ì¹´ë“œ ì•ë©´
        ============================= */
        .flip-card-front {
            background: linear-gradient(135deg, #6a7bff, #3c4bff);
            color: #fff;
            font-size: 1.4em;
            font-weight: 600;

            border-radius: 18px;
            box-shadow: 0 10px 28px rgba(0,0,0,0.18);

            display: flex;
            justify-content: center;
            align-items: center;

            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
        }

        /* =============================
           ì¹´ë“œ ë’·ë©´
        ============================= */
        .flip-card-back {
            background: #ffffff;
            color: #222;
            border-radius: 18px;
            padding: 18px;
            box-shadow: 0 10px 28px rgba(0,0,0,0.18);

            display: flex;
            flex-direction: column;
            text-align: left;

            position: absolute;
            width: 100%;
            height: 100%;
            transform: rotateY(180deg);
            backface-visibility: hidden;
        }

        .flip-card-back img {
            width: 100%;
            height: 170px;
            object-fit: contain;
            margin-bottom: 15px;
            background: #f4f6fa;
            border-radius: 12px;
        }

        /* ì¹´ë“œ ì œëª© */
        .flip-card-back h2 {
            font-size: 1.3em;
            font-weight: 700;
            margin: 5px 0;
            color: #111;
        }

        /* ë¸Œëœë“œ */
        .flip-card-back p {
            margin: 4px 0;
            font-size: 0.95em;
            font-weight: 500;
            color: #444;
        }

        /* í˜œíƒ */
        .benefit {
            font-size: 0.95em;
            font-weight: 600;
            color: #4962ff;
            margin-top: 8px;
        }

        /* ìƒì„¸ ë³´ê¸° í…ìŠ¤íŠ¸ */
        .toggle-btn {
            display: inline-block;
            margin-top: auto;
            font-size: 0.95em;
            color: #5865ff;
            cursor: pointer;
            font-weight: 600;
            transition: .2s;
        }
        .toggle-btn:hover {
            color: #3c4bff;
        }

        /* =============================
           ë²„íŠ¼ ì˜ì—­
        ============================= */
        .btn-area {
            margin-top: 45px;
        }
        .btn-area button {
            background: #4f5fff;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            color: white;
            font-size: 1em;
            font-weight: 600;
            margin: 0 10px;
            transition: 0.25s ease;
        }
        .btn-area button:hover {
            transform: translateY(-4px);
            background: #3948eb;
        }

        /* =============================
           ì¶”ì²œ ë‚ ì§œ í‘œì‹œ
        ============================= */
        .date {
            margin-top: 25px;
            color: #555;
            font-size: 0.95em;
        }

        /* =============================
           ëª¨ë‹¬
        ============================= */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.65);
            display: flex;
            align-items: center;
            justify-content: center;
            visibility: hidden;
            opacity: 0;
            transition: 0.3s;
            z-index: 99999 !important; /* â­ ìµœìƒë‹¨ ê°•ì œ */
        }
        .modal.show {
            visibility: visible;
            opacity: 1;
        }

        /* ëª¨ë‹¬ ì½˜í…ì¸  */
        .modal-content {
            background: white;
            border-radius: 18px;
            padding: 25px;
            width: 92%;
            max-width: 640px;
            color: #222;
            position: relative;

            animation: modalPop .35s ease;
            z-index: 100000 !important; /* â­ ëª¨ë‹¬ ë‚´ìš© ì œì¼ ìœ„ */
        }

        @keyframes modalPop {
            from { opacity: 0; transform: scale(0.85); }
            to   { opacity: 1; transform: scale(1); }
        }

        .modal-content img {
            width: 100%;
            max-height: 240px;
            object-fit: contain;
            background: #f1f5f9;
            border-radius: 12px;
            margin-bottom: 18px;
        }

        .close-btn {
            position: absolute;
            top: 12px;
            right: 18px;
            font-size: 26px;
            color: #666;
            cursor: pointer;
        }
        .close-btn:hover {
            color: #ff4e6b;
        }

        /* =============================
           ë°˜ì‘í˜•
        ============================= */
        @media (max-width: 480px) {
            .flip-card {
                width: 90%;
                height: 420px;
            }
        }

    </style>
</head>

<body>

<div th:replace="events/header :: header"></div>

<h1>ì˜¤ëŠ˜ì˜ ì¹´ë“œ 3ì¥ì„ ë’¤ì§‘ì–´ë³´ì„¸ìš”!</h1>

<!-- ëª¨ë‹¬ -->
<div id="cardModal" class="modal">
    <div id="modalContent" class="modal-content">
        <span class="close-btn" onclick="closeModal()">Ã—</span>
    </div>
</div>

<div class="cards-container">
    <div class="flip-card"
         th:each="ev : ${randoms}"
         th:data-benefits-json="${ev.jsonBenefits}"
         onclick="flipCard(this)">

        <div class="flip-card-inner">

            <!-- ì•ë©´ -->
            <div class="flip-card-front">ğŸ² ì¹´ë“œ ë’¤ì§‘ê¸°</div>

            <!-- ë’·ë©´ -->
            <div class="flip-card-back" onclick="event.stopPropagation(); showModal(this)">
                <img th:src="${ev.card.cardImg != '' ? ev.card.cardImg : '/images/bono.png'}"
                     onerror="this.src='/images/bono.png'">

                <h2 th:text="${ev.card.cardName}"></h2>
                <p><strong>ë¸Œëœë“œ:</strong> <span th:text="${ev.card.cardBrand}"></span></p>

                <!-- ì²« í˜œíƒ (ì•ˆì „ ì²˜ë¦¬) -->
                <p class="benefit"
                   th:text="${#lists.isEmpty(ev.benefits) ? 'í˜œíƒ ì •ë³´ ì—†ìŒ' :
                            (ev.benefits.get(0).bnfContent != '' ? ev.benefits.get(0).bnfContent : 'í˜œíƒ ë‚´ìš© ì—†ìŒ')}">
                </p>

                <span class="toggle-btn">ğŸ‘† ìì„¸íˆ ë³´ê¸°</span>
            </div>
        </div>

    </div>
</div>

<div class="btn-area">
    <button onclick="location.href='/events/random'">ğŸ” ë‹¤ì‹œ ë½‘ê¸°</button>
    <button onclick="location.href='/events/benefits'">â¡ í˜œíƒë³„ ë³´ê¸°</button>
</div>

<div class="date" th:text="'ì¶”ì²œ ë‚ ì§œ: ' + ${date}"></div>

<div th:replace="events/footer :: footer"></div>

<script>
    // âœ… í˜ì´ì§€ ë¡œë”© ëë‚˜ë©´ í˜ì´ë“œì¸
    window.addEventListener("load", () => {
        document.body.classList.add("loaded");
    });

    function flipCard(card) {
        card.classList.add("flipped");
    }

    /* ëª¨ë‹¬ ì—´ê¸° */
    function showModal(el) {
        const modal = document.getElementById("cardModal");
        const content = document.getElementById("modalContent");

        const img = el.querySelector("img").src;
        const name = el.querySelector("h2").innerText;
        const brand = el.querySelector("span").innerText;

        // ğŸ” jsonBenefits null/ë¹ˆë¬¸ì ë°©ì–´
        const benefitsJson = el.closest(".flip-card").dataset.benefitsJson || "[]";
        const benefits = JSON.parse(benefitsJson);

        let listHtml = "";
        benefits.forEach(b => {
            listHtml += `<li style="margin-bottom:6px;">
                            <strong>${b.name}</strong> - ${b.content}
                         </li>`;
        });

        content.innerHTML = `
            <span class="close-btn" onclick="closeModal()">Ã—</span>
            <img src="${img}">
            <h2>${name}</h2>
            <p><strong>ë¸Œëœë“œ:</strong> ${brand}</p>

            <h3>í˜œíƒ ëª©ë¡</h3>
            <ul style="padding-left: 20px; line-height: 1.5;">
                ${listHtml}
            </ul>
        `;

        modal.classList.add("show");
    }

    function closeModal() {
        document.getElementById("cardModal").classList.remove("show");
    }

    window.addEventListener("keydown", e => {
        if (e.key === "Escape") closeModal();
    });
</script>


</body>
</html>
